<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="codemanagement.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="editor.css">        
</head>
<body>
<iframe id="run" src="run.html" frameborder="0" style="display:none;width:100%;height:100%;position:absolute;top:0;bottom:0;left:0;right:0"></iframe>
<div id="editor">
<tj-program>
<tj-section-title>Prolog</tj-section-title>

<tj-operation>
  <tj-signature>Constants</tj-signature>
  <tj-body>
    <textarea>var G = 6.67428e-11;
var TIMESCALE = 525600 * 6; // 6 x Minutes per year
var SCALE = 1e-9;
var OC = "https://openclipart.org/download/";</textarea>
  </tj-body>
</tj-operation>
<tj-operation>
  <tj-signature>Globals</tj-signature>
  <tj-body>
    <textarea>var bodies = [];</textarea>
  </tj-body>
</tj-operation>

<tj-section-title>Functions</tj-section-title>

<tj-operation>
  <tj-signature>update()</tj-signature>
  <tj-body>
    <textarea>for (var i = 0; i < bodies.length; i++) {
  var bodyI = bodies[i];
  for (var j = 0; j < bodies.length; j++) {
    if (i != j) {
      bodyI.addAttraction(bodies[j]);
    }
  }
  bodyI.update(TIMESCALE / 60);
}
window.requestAnimationFrame(update);</textarea>
  </tj-body>
</tj-operation>


<tj-section-title>Classes</tj-section-title>
<tj-class>
<tj-signature>Body</tj-signature>
<tj-body>
  <tj-operation>
    <tj-signature>constructor(mass, distance, speed, size, color)</tj-signature>
    <tj-body>
      <textarea>this.mass = mass;
this.x = 0;
this.y = -distance;
this.vx = speed;
this.vy = 0;
this.fx = 0;
this.fy = 0;
this.size = size;
this.img = document.createElement("div");
this.img.style.width = size + "px";
this.img.style.height = size + "px";
this.img.style.borderRadius = size/2 + "px";
this.img.style.backgroundColor = color;
this.img.style.position = "absolute";
document.body.appendChild(this.img);</textarea>
    </tj-body>
  </tj-operation>
  <tj-section-title>Operations</tj-section-title>
  <tj-operation>
    <tj-signature>addAttraction(other)</tj-signature>
    <tj-body>
      <textarea>var dx = other.x - this.x;
var dy = other.y - this.y;
var r2 = dx * dx + dy * dy;  
var f = G * this.mass * other.mass / r2; // * this.mass / d;
var th = Math.atan2(dy, dx);
this.fx += f * Math.cos(th);
this.fy += f * Math.sin(th);</textarea>
    </tj-body>
  </tj-operation>
  <tj-operation>
    <tj-signature>update(dt)</tj-signature>
    <tj-body>
      <textarea>this.vx += dt * this.fx / this.mass;
this.vy += dt * this.fy / this.mass;
this.x += this.vx * dt;
this.y += this.vy * dt;
this.img.style.left = 
  (window.innerWidth - this.size) / 2 + 
    this.x * SCALE + "px";
this.img.style.top = 
  (window.innerHeight - this.size) / 2 + 
    this.y * SCALE + "px";
this.fx = 0;
this.fy = 0;</textarea>
    </tj-body>
  </tj-operation>
</tj-body>

</tj-class>


<tj-section-title>Epilog</tj-section-title>

<tj-operation>
  <tj-signature>Main program</tj-signature>
  <tj-body>
    <textarea>bodies.push(new Body(
  1.99e30, 0, 0, 24, "#ffa"));

bodies.push(new Body(
  3.3e23, 58e9, 47.36e3, 6, "#888"));

bodies.push(new Body(
  4.87e24, 108e9, 35e3, 12, "#dcc"));

bodies.push(new Body(
  5.97e24, 150e9, 29.8e3, 12, "#66e"));

bodies.push(new Body(
  6.42e23, 228e9, 24.1e3, 8, "#fa5"));

document.body.style.backgroundColor = "black";

update();

</textarea>
  </tj-body>
</tj-operation>

</tj-section>
</tj-program>

<div style="position:fixed;right:16px;bottom:16px;padding:18px 22px;box-sizing:border-box;background-color:red;color:white;width:56px;height:56px;border-radius:27px;font-size:18px;" 
     onclick="run()">&#9654;</div>
</div>    

<script src="editor.js"></script>
</body>
</html>