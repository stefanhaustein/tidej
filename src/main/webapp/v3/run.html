<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" sizes="192x192" href="img/tidej.png">
</head>    
<img>
<tj-program id="program" style="display:none"></tj-program>
<script src="js/io.js"></script>
<script src="js/codemanagement.js"></script>
<script>

var params = io.parseParams(window.location.hash.substr(1));
window.console.log("params:", params);
io.loadContent({id: params['id']}, runProgram);

function runProgram(programXml) {
  var programElement = document.getElementById("program");
  programElement.innerHTML = programXml;
  var map = {};
  var code = buildCode(map, 0, programElement);
  window.console.log(map);
  var script = document.createElement("script");
  script.textContent = code;
  document.body.appendChild(script);
}

function backToIde() {
  window.console.log("back");
  var hash = "";
  for (var key in params) {
    if (hash != "") {
      hash += ";";
    }
    hash += key + "=" + params[key];
  }
  window.location.href = "/v3/#" + hash;
}

function showBackButton() {
  var backElement = document.getElementById('back-to-ide');
  if (backElement == null) {
    backElement = document.createElement('img');
    backElement.id = "back-to-ide";
    backElement.src = "img/tidej.png";
    backElement.width = 32;
    backElement.style.borderRadius = "4px";
    backElement.style.position = "absolute";
    backElement.style.bottom = "16px";
    backElement.style.right = "16px";
    backElement.onclick = backToIde;
    backElement.style.cursor = "pointer";
    document.body.appendChild(backElement)
  }
}

showBackButton();
setInterval(showBackButton, 1000);

</script>
    
</body>
</html>